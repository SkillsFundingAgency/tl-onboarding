var myCalendar,calendarData=[],$dateListItemTemplage=$("[data-date-template]").clone(),$dateFlaggedItemTemplage=$("[data-flagged-template]").clone();function getCalendarData(a,t,e){e||(e=1),$.get("https://sheets.googleapis.com/v4/spreadsheets/"+t+"/values/sheet1?key="+a,function(a){a.values.forEach((a,t)=>{t&&calendarData.push({date:a[0].substr(6,4)+"-"+a[0].substr(3,2)+"-"+a[0].substr(0,2),title:a[1],description:a[2],flagged:"Yes"==a[3],link1:a[4],link2:a[5]})}),calendarData.sort((a,t)=>a.date>t.date?1:t.date>a.date?-1:0),calendarInit(),buildFlaggedDates(),$(window).resize(function(){$("[data-set-min-height]").css("min-height","auto")}),$('[data-calendar-state="loading"]').hide(),$('[data-calendar-state="loaded"]').addClass("event-wrapper--show")}).fail(function(){e<5?setTimeout(function(){getCalendarData(a,t,++e)},2e3):($('[data-calendar-state="loading"]').hide(),$('[data-calendar-state="error"]').show())})}function calendarInit(){var a=moment().format("YYYY-MM-DD"),t=[...new Set(calendarData.map(a=>a.date))];myCalendar=new TavoCalendar("#events-calendar",{selected:t}),buildEventList(a)}function updateEventListMonth(a){buildEventList(a+"-01")}function updateEventListDay(a){buildEventList(moment(a).format("YYYY-MM-DD"),!0),$(".event-calendar__user-selected").removeClass("event-calendar__user-selected")}function buildEventList(a,t){$(".event-calendar__displaying-date").removeClass("event-calendar__displaying-date"),$("[data-dates]").empty();var e=$("[data-no-dates]"),d=[];calendarData.forEach((e,n)=>{if(!t||e.date===a){var i=$dateListItemTemplage.clone();i.attr("data-date-index",n),i.attr("data-event-date",e.date),$("[data-date-date]",i).text(moment(e.date).format("DD MMMM YYYY")),$("[data-date-title]",i).text(e.title),$("[data-date-link1]",i).attr("href",e.link1),$("[data-date-link2]",i).attr("href",e.link2),$("[data-date-description]",i).text(e.description),$("[data-date-description-toggle]",i).click(function(a){a.preventDefault(),toggleEventDescription(n)}),""!==e.description&&$("[data-date-description-toggle]",i).removeClass("tl-js-hidden"),t&&(i.removeClass("feature-panels__panel--front-door"),i.addClass("feature-panels__panel--dark")),d.push(i)}});var n=$('<div class="feature-panels feature-panels--small-margin event-list__page" />'),i=n.clone();i.addClass("event-list__page--current");var r=!1;d.filter(t=>moment(a).diff(t.attr("data-event-date"),"days")<1).forEach((a,t)=>{a.appendTo(i),r=!0,i.hasClass("event-list__page--current")&&$('[data-calendar-day-date="'+a.attr("data-event-date")+'"]').addClass("event-calendar__displaying-date"),(t+1)%3==0&&(i.appendTo("[data-dates]"),i=n.clone(),r=!1)}),r&&(i.appendTo("[data-dates]"),i=n.clone(),r=!1),d.filter(t=>moment(a).diff(t.attr("data-event-date"),"days")>0).sort((a,t)=>a.attr("data-event-date")<t.attr("data-event-date")?1:t.attr("data-event-date")<a.attr("data-event-date")?-1:0).forEach((a,t)=>{a.prependTo(i),r=!0,i.hasClass("event-list__page--current")&&$('[data-calendar-day-date="'+a.attr("data-event-date")+'"]').addClass("event-calendar__displaying-date"),(t+1)%3==0&&(i.prependTo("[data-dates]"),i=n.clone(),r=!1)}),r&&(i.prependTo("[data-dates]"),i=n.clone(),r=!1),setEventListPagination(),$(".feature-panels","[data-dates]").length>0&&e.hide()}function setEventListPagination(){if($(".feature-panels","[data-dates]").length>1){$("[data-event-pagination]").show();var a=$(".event-list__page","[data-dates]").length,t=$(".event-list__page--current","[data-dates]").index();0===t?$('[data-event-pagination-direction="previous"]').parent().hide():$('[data-event-pagination-direction="previous"]').parent().show(),t+1===a?$('[data-event-pagination-direction="next"]').parent().hide():$('[data-event-pagination-direction="next"]').parent().show()}else $("[data-event-pagination]").hide()}function toggleEventDescription(a){sizeSizer("calendar-list"),$('[data-date-index="'+a+'"] [data-date-description-wrapper]').toggleClass("event-description-wrapper--expand"),$('[data-date-index]:not([data-date-index="'+a+'"])').toggle()}function buildFlaggedDates(){var a=$("[data-flagged-dates]"),t=$("[data-flagged-list]"),e=$("[data-flagged-dates-link]");t.empty(),calendarData.filter(a=>a.flagged&&moment().diff(a.date,"days")<1).forEach((d,n)=>{var i=$dateFlaggedItemTemplage.clone();i.attr("data-flagged-index",n),$("[data-flagged-date]",i).text(moment(d.date).format("DD MMMM YYYY")),$("[data-flagged-title]",i).text(d.title),$("[data-flagged-description]",i).text(d.description),$("[data-flagged-description-toggle]",i).click(function(a){a.preventDefault(),toggleFlaggedDescription(n)}),i.appendTo(t),a.show(),e.css("display","inline-block")})}function toggleFlaggedDescription(a){sizeSizer("flagged-dates"),$('[data-flagged-index="'+a+'"] [data-flagged-description-wrapper]').toggleClass("event-description-wrapper--expand"),$('[data-flagged-index]:not([data-flagged-index="'+a+'"])').toggle()}function sizeSizer(a){$('[data-set-min-height="'+a+'"]').css("min-height",$('[data-set-min-height="'+a+'"]').height())}function frontDoor(a,t){getCalendarData(a,t),$(window).scroll(function(){$(this).scrollTop()>400?$("[data-scroll-to-top]").addClass("scroll-to-top--show"):$("[data-scroll-to-top]").removeClass("scroll-to-top--show")}),$("[data-scroll-to-top]").click(function(){return $("html, body").animate({scrollTop:0},500),!1}),$("[data-accordion-link]").click(function(a){a.preventDefault();var t=$(this).attr("data-accordion-link");$(this).find("[data-accordion-state]").text(function(a,t){return"Hide"===t?"Show":"Hide"}),$('[data-accordion-body="'+t+'"]').toggle();var e=null!==localStorage.getItem("hide-"+t)&&"true"===localStorage.getItem("hide-"+t);localStorage.setItem("hide-"+t,!e)}),$("[data-scroll-to]").click(function(a){a.preventDefault();var t=$(this).attr("data-scroll-to");$("html, body").animate({scrollTop:$("#"+t).offset().top},500),$('[data-accordion-link="'+t+'"]').find("span").text("Hide"),$('[data-accordion-body="'+t+'"]').show(),localStorage.setItem("hide-"+t,!1)}),$("[data-accordion-link]").each(function(){var a=$(this).attr("data-accordion-link");"true"===localStorage.getItem("hide-"+a)&&($(this).find("[data-accordion-state]").text(function(a,t){return"Hide"===t?"Show":"Hide"}),$('[data-accordion-body="'+a+'"]').toggle())})}$("[data-event-pagination-direction]").click(function(a){var t;a.preventDefault(),sizeSizer("calendar-list");var e=$(".event-list__page--current","[data-dates]").index();"next"===$(this).attr("data-event-pagination-direction")?e++:e--,$(".event-list__page--current","[data-dates]").removeClass("event-list__page--current"),$(".event-list__page","[data-dates]").eq(e).addClass("event-list__page--current"),setEventListPagination(),$(".event-description-wrapper--expand").removeClass("event-description-wrapper--expand"),$("[data-date-index]").show(),$(".event-calendar__displaying-date").removeClass("event-calendar__displaying-date"),t="next"===$(this).attr("data-event-pagination-direction")?$(".event-list__page--current [data-event-date]","[data-dates]").first().attr("data-event-date"):$(".event-list__page--current [data-event-date]","[data-dates]").last().attr("data-event-date"),myCalendar.setFocusYear(moment(t).format("YYYY")),myCalendar.setFocusMonth(moment(t).format("MM")),$(".event-list__page","[data-dates]").eq(e).find("[data-event-date]").each(function(){$('[data-calendar-day-date="'+$(this).attr("data-event-date")+'"]').addClass("event-calendar__displaying-date")})});